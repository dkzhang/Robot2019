# 1. 机器人移动

---

## 1.1 单目标点移动

**指令：** `/api/move`
**参数：**

|名称|说明|是否必选|备注|从以下版本开始|
|----|:--:|:------:|:--:|:------------:|
|marker|目标点位代号|与location必选其一|优先级低于location| |
|location|x<地图中x轴坐标>,y<地图中y轴坐标>,theta<地图中相对theta值>|与marker必选其一| | |
|max_continuous_retries|原地最大连续重试次数（机器人原地不动时，重试次数超过此值则任务失败)|可选|默认30次|0.7.11|
|distance_tolerance|距离容差,类型float,单位米。(当目标位置被占据等原因无法到达时，机器人移动到目标此距离之内也算任务成功。)|可选|默认值跟机器人型号相关|0.7.12|
|theta_tolerance|角度容差，类型float，单位弧度。(到达目标点位后，角度小于此值后任务成功)|可选|默认值跟机器人型号相关|0.7.12|

**接口描述**

可使机器人从当前位置移动至地图中已经标定的某个目标点。

> **协议中对于移动指令部分包括两大主要的形式：**

> * 对于需要使机器人在运动过程中使用自动导航和避障功能的，请使用此接口；
> * 如果需要使用诸如手柄遥控功能的，请使用接口6，会直接操控机器人两轮的速度;

**在使用此接口之前还有必要的扫图工作需要使用者提前安排（云迹提供一套通过局域网连接机器人，然后登入浏览器进行扫图的方案，具体操作参考《WATER（水滴）用户使用手册》）。**
参数中的location的坐标是相对于“地图”坐标系的，由于直接调用(x、y、theta)在使用中不够直观和方便，云迹提供“事先标锚点，而后使机器人重返锚点”的工作形式。之后“锚点”统一用marker代称，设置和查询已设锚点的方式见接口4、接口5。

机器人采用自动导航和避障的过程中，机器人会自动规划路径和调节速度，过程中不需要操作者干预。操作者可以监听robot_status(机器人整体和行进状态)，或者等待相应的notification，以了解任务完成情况和整机状态。

**示例:**
发送:
```
/api/move?marker=target_name
// 调用移动接口，移动至代号为"target_name"的目标点
/api/move?location=15.0,4.0,1.5707963
// 调用移动接口，移动至location(15.0, 4.0, pai/2)的目标点
```
返回:
```
{
    "type": "response",
    "command": "/api/move",
    "uuid": "",
    "status": "OK",
    "error_message": "",
    "task_id": "xxx" // （软件版本0.7.3之后新增） 32个字节的uuid，例如：436253D1D6284ACC984620CCB94EB5E5
}
```

## 1.2多目标点移动
**指令：** `/api/move`
**参数：**
|名称|说明|是否必选|备注|从以下版本开始|
|----|:--:|:------:|:--:|:------------:|
|markers|想要巡游的点位列表，点位名称之间用英文逗号分开|必选|不能少于两个点位，不支持跨楼层| |
|count|巡游的次数，所有点位走过一遍之后计为一次|可选|不选时为默认一次，-1表示无限循环。| |
|distance_tolerance|点位到达时的容差，表示靠近点位多少距离时继续下一个点位。|可选|默认0.5(米),最小0.5| |
|max_continuous_retries|原地最大连续重试次数（机器人原地不动时，重试次数超过此值则去当前巡游点位任务失败)	|可选|默认5次|0.7.11|

**示例:**
发送: `/api/move?markers=m1,m2,m3&distance_tolerance=1.0&count=-1`
返回:
```
{
    "type": "response",
    "command": "/api/move",
    "uuid": "",
    "status": "OK",
    "error_message": "",
    "task_id": "xxx" // （软件版本0.7.3之后新增） 32个字节的uuid，例如：436253D1D6284ACC984620CCB94EB5E5
}
```














